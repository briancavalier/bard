<!DOCTYPE html>
<html>
<head>
<title>Demo using Object.observe(array)</title>

<script src="../amd_modules/curl/src/curl.js"></script>

<script>
curl.config(
	{
		baseUrl: '',
		packages: {
			bard: { location: '../' },
			curl: { location: '../amd_modules/curl/src/curl' }
		}
	}
);

curl(['bard/array', 'bard/model'], function (array, model) {
	var root, form, reactiveList, reactiveForm, coders;

	root = document.getElementById('list');
	form = document.getElementById('edit');

	reactiveList = array(root, {
		sectionName: 'person',
		id: 'spid',
		sortBy: 'lastname',
		transform: function (val, key) {
			if (val == null && /superpower$/.test(key)) return 'retrieving...';
			else return val;
		}
	});
	reactiveForm = model(form, { sectionName: 'person' });

	coders = [];
	Object.observe(coders, reactiveList.updateModel);

	coders.push({
		spid: 1,
		firstname: 'Brian',
		lastname: 'Cavalier'
	});
	coders.push({
		spid: 2,
		firstname: 'John',
		lastname: 'Hann'
	});

	setTimeout(function () {
		coders[0] = {
			spid: coders[0].spid,
			firstname: coders[0].firstname,
			lastname: coders[0].lastname,
			superpower: 'Can has mind meld with the codez.'
		};
		coders[1] = {
			spid: coders[1].spid,
			firstname: coders[1].firstname,
			lastname: coders[1].lastname,
			superpower: 'Able to cram many codez into one file.'
		};
		coders.push({
			spid: 3,
			firstname: 'Scott',
			lastname: 'Andrews',
			superpower: 'Can rest just about anywhere.'
		});
	}, 2000);

	document.body.addEventListener('click', function (e) {
		e.preventDefault();
		var coder = reactiveList.findItem(e);
		if (coder) {
			// how do we observe real-time changes?
			reactiveForm.setModel(coder);
		}
	}, false);

	// TODO: why aren't these form events firing?

	form.addEventListener('submit', function (e) {
		e.preventDefault();
		var coder = reactiveForm.findItem(e);
		if (coder) {
			// now what?
		}
	}, false);

	form.addEventListener('rest', function (e) {
		e.preventDefault();
		reactiveForm.clear();
	}, false);

});
</script>

</head>
<body>

<h2>Super coders</h2>

<ul id="list" data-bard-section="person">
	<li>
		<h3>
			<span data-bard-bind="text:lastname"></span>,
			<span data-bard-bind="text:firstname"></span>
		</h3>
		<i><span data-bard-bind="text:superpower"></span></i>
	</li>
</ul>

<p>(click to edit)</p>
<hr/>
<form method="post" action="#" id="edit" data-bard-section="person">
	<h3>
		Super coder: <span data-bard-bind="text:lastname"></span>
		<span data-bard-bind="text:firstname"></span>
	</h3>
	<label>
		Super power:
		<textarea data-bard-bind="value:superpower"></textarea>
	</label>
	<br/>
	<button type="submit">Save</button>
	<button type="reset">Clear</button>
</form>

<style>
	ul { padding: 0; background-color: #eee; }
	li { list-style: none; }
	li:hover { background-color: #efe; }
</style>
</body>
</html>